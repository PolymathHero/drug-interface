<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Find and purchase various drugs from different suppliers.">
    <meta name="keywords" content="drug sales, buy drugs, drug suppliers, pharmaceutical">
    <meta name="author" content="Your Name">
    <title>Drug Sales</title>
    <link rel="stylesheet" href="styles.css">
    <!-- Supabase JavaScript Client Library via CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>

<body>
    <header>
        <h1>Drug Sales</h1>
    </header>

    <main>
        <section id="searchSection">
            <form id="searchForm" aria-labelledby="searchLabel">
                <label for="searchInput" id="searchLabel">Search for a drug:</label>
                <input type="text" id="searchInput" list="suggestions" aria-describedby="searchHelp" />
                <button type="submit" id="searchButton">Search</button>
                <datalist id="suggestions">
                    <option value="Panadol"></option>
                    <option value="Doliprane"></option>
                    <option value="Fervex"></option>
                </datalist>
            </form>
        </section>

        <section id="filterSection">
            <label for="filterSelect">Filter by Supplier:</label>
            <select id="filterSelect">
                <option value="">All</option>
                <option value="Supplier 1">Supplier 1</option>
                <option value="Supplier 2">Supplier 2</option>
                <option value="Supplier 3">Supplier 3</option>
                <!-- Add more options based on your actual suppliers -->
            </select>
        </section>

        <section id="resultsSection">
            <h2>Search Results:</h2>
            <div id="results" aria-live="polite"></div>
        </section>
    </main>

    <footer>
        <p>&copy; 2024 Your Name. All rights reserved.</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const supabaseUrl = 'https://opyjzrczlxmwgspveoyh.supabase.co';
            const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9weWp6cmN6bHhtd2dzcHZlb3loIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTM5NjI2NzIsImV4cCI6MjAyOTUzODY3Mn0.Ysi-eZwxqll0_40l6cKP934yQEDBSDaJ5tcgB9yZPDw';
            const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);

            const searchForm = document.getElementById('searchForm');
            const filterSelect = document.getElementById('filterSelect');
            const resultsDiv = document.getElementById('results');

            async function fetchAndDisplayDrugs(searchInput, supplierFilter) {
                let query = supabaseClient
                    .from('drug_table')
                    .select('drug_name_column, drug_supplier_column');

                if (searchInput) {
                    query = query.ilike('drug_name_column', `%${searchInput}%`);
                }

                if (supplierFilter) {
                    query = query.eq('drug_supplier_column', supplierFilter);
                }

                const { data, error } = await query;

                if (error) {
                    console.error('Error fetching data:', error);
                    resultsDiv.innerText = 'Error fetching data.';
                    return;
                }

                resultsDiv.innerHTML = '';
                if (data.length > 0) {
                    data.forEach(drug => {
                        const drugDiv = document.createElement('div');
                        drugDiv.innerText = `${drug.drug_name_column} - Supplier: ${drug.drug_supplier_column}`;
                        resultsDiv.appendChild(drugDiv);
                    });
                } else {
                    resultsDiv.innerText = 'No results found.';
                }
            }

            searchForm.addEventListener('submit', async (event) => {
                event.preventDefault();
                const searchInput = document.getElementById('searchInput').value;
                const supplierFilter = filterSelect.value;
                await fetchAndDisplayDrugs(searchInput, supplierFilter);
            });

            filterSelect.addEventListener('change', async () => {
                const searchInput = document.getElementById('searchInput').value;
                const supplierFilter = filterSelect.value;
                await fetchAndDisplayDrugs(searchInput, supplierFilter);
            });

            await fetchAndDisplayDrugs('', '');
        });
    </script>
</body>

</html>
